#!/bin/sh

echo "------------------------------------------------"
echo "Running Pre-commit Checks"
echo "------------------------------------------------"

# 1. Validate FOA Flux Definitions
echo "[API] Validating flux definitions..."
cd api || exit 1
if ! ./node_modules/.bin/foa validate; then
  echo "[API] Flux validation failed."
  exit 1
fi
echo "[API] Validation OK"

# Return to root
cd ..

# 2. Run Frontend Tests & Formatting
echo "[FRONTEND] Checking formatting..."
cd frontend || exit 1

if ! bunx prettier --check "src/**/*.{ts,tsx,json,css}"; then
  echo "[FRONTEND] Code is not formatted."
  echo "Please run 'cd frontend && bun run format' to fix it."
  exit 1
fi
echo "[FRONTEND] Formatting OK"

echo "[FRONTEND] Running tests..."
if ! bun run test; then
  echo "[FRONTEND] Tests failed."
  exit 1
fi
echo "[FRONTEND] Tests passed"

echo "------------------------------------------------"
echo "All checks passed! Committing..."
echo "------------------------------------------------"
