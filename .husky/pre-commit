#!/bin/sh

echo "------------------------------------------------"
echo "ğŸš€ Running Pre-commit Checks"
echo "------------------------------------------------"

# 1. Check Go Formatting
echo "ğŸ” [API] Checking Go formatting..."
cd api || exit 1
UNFORMATTED=$(gofmt -l .)
if [ -n "$UNFORMATTED" ]; then
  echo "âŒ [API] Go code is not formatted:"
  echo "$UNFORMATTED"
  echo "ğŸ‘‰ Please run 'cd api && gofmt -w .' to fix it."
  exit 1
fi
echo "âœ… [API] Formatting OK"

# 2. Run Go Tests
echo "ğŸ§ª [API] Running tests..."
if ! go test ./...; then
  echo "âŒ [API] Tests failed."
  exit 1
fi
echo "âœ… [API] Tests passed"

# Return to root
cd ..

# 3. Run Frontend Tests & Formatting
echo "ğŸ” [FRONTEND] Checking formatting..."
cd frontend || exit 1

if ! bunx prettier --check "src/**/*.{ts,tsx,json,css}"; then
  echo "âŒ [FRONTEND] Code is not formatted."
  echo "ğŸ‘‰ Please run 'cd frontend && bun run format' to fix it."
  exit 1
fi
echo "âœ… [FRONTEND] Formatting OK"

echo "ğŸ§ª [FRONTEND] Running tests..."
if ! bun run test; then
  echo "âŒ [FRONTEND] Tests failed."
  exit 1
fi
echo "âœ… [FRONTEND] Tests passed"

echo "------------------------------------------------"
echo "ğŸ‰ All checks passed! Committing..."
echo "------------------------------------------------"
